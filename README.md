Project Template
================

We have posted a template Vivado project for HW4 on the course website. Here is an introduction of the template project

In the provided template project we have set up the clock generator, ADC controller, and part of the top design for you. Based on the provided template, you need to move your previously designed modules (music code decoder, symbol detector, UART) into this project.

The project source file hierarchy
=================================

/ip
---

Including all the Xilinx IP we need in this project. **No need to modify it**

A clock wizard IP is already instantiated to divide the 100 MHz system clock ```clk_100m``` from the onboard oscillator to a 12.288 MHz clock ```clk_12288k```. The divided clock it is used to drive the ADC controller ```adccntrl```.

/prj
----

The project xpr file is under /prj.

/rtl
----

This folder includes all the rtl files (VHDL) of this project.

*   `clk_div.vhd` -- Generate 96kHz clock ```clk``` from ```clk_12288k``` **(Do not modify)**
*   `adccntrl.vhd` -- ADC driver **(Do not modify)**
*   `symb_det.vhd` – Decode symbols from ADC output
*   `mcdecoder.vhd` -- Decode ASCII code from music code symbol
*   `myuart.vhd` – UART - parallel to serial output
*   `sys_top.vhd` -- System top of this project **(We provide part of it, you may need to modify)**
*   `sim_top.vhd` -- **Only for simulation.** We provide the real ADC input in which the sine wave is no longer pure but with a mix of higher-frequency noises. You should modify your previously designed symbol detector so it can detect correctly!

/tb
---

This folder is used for testbench (vhdl) and data files (input waves and scripts). To use them, please refer to the scripts to check the arguments in detail.

*   `audio_gen.py` – Generate audio file (.wav) when you are ready to test on board and real ADC.
*   `info_wave_gen.py` – Generate input waves file based on your “information” (a string), which can be used for simulation as the input of symbol detector.
*   `audio_waves.wav` -- We provide an audio file to you, which is for “ENJOY FLATWHITE!” demo. It is generated by `audio_gen.py`
*   `info_wave.txt` -- Waveform with noise mixed. It has been added to the project so you do not need to re-add it. It is generated by `info_wave_gen.py`
*   `sim_top_tb.vhd` -- We provide the real ADC input in which the sine wave is no longer pure but with a mix of higher-frequency noises. You should modify your previously designed symbol detector so it can detect correctly!

/xdc
----

This folder is used for constraint files (xdc). **Please refer to digilent Basys 3 board reference if you want to connect your microphone.**

TODO
===============

*   Improve your symbol detector to work with noise (_Hint:_ counting zero crossing alone cannot determine the frequency from the audio reliablily as the ADC value may skew from pos->neg, neg->pos several times around a crossing point. Any noise filtering you can use?)

    ![Screenshot_2022-11-15_at_5.31.34_PM.pngNaN](https://cdn-uploads.piazza.com/paste/l7gzu9s26e04qe/905cdd19c54e4386504fbf06587ba99e0833f4e65b6a1edd5de996f4c75404a4/Screenshot_2022-11-15_at_5.31.34_PM.png)

*   Do not change the interface port names because we have provided the testbench for you.
*   After capstone 1 is accomplished. Connect the microphone module to the upper row of port JA. Please refer to the [Basys 3 board reference manual](https://digilent.com/reference/programmable-logic/basys-3/reference-manual?srsltid=AfmBOopyJ9j6mA28p0PlrYDbfFLm7RuB9wxHMMygnvBFHtUREZJxdfho) and the xdc file, to make sense of how physical pins are assigned. You can also refer to the figure below:
    
*   If you are good at Python and want to explore some extensions for different massages, you can use the `audio_gen.py`

References
==========

*   [Digilent Basys 3](https://digilent.com/reference/_media/basys3:basys3_rm.pdf)
*   [Digilent PMOD MIC 3](https://digilent.com/reference/_media/reference/pmod/pmodmic3/pmodmic3_rm.pdf)
*   [ADCS7476](https://www.ti.com/lit/ds/symlink/adcs7476.pdf)
*   [Setting up Vivado to use VHDL-2008 if you need](https://docs.xilinx.com/r/en-US/ug901-vivado-synthesis/Setting-up-Vivado-to-use-VHDL-2008)